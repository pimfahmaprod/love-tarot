<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ความหมายไพ่ยิปซี - ใครจะเข้ามาในชีวิตคุณช่วงวาเลนไทน์</title>

    <!-- Open Graph Meta Tags for Social Sharing -->
    <meta property="og:title" content="ดูดวงความรักวาเลนไทน์ - ใครจะเข้ามาในชีวิตคุณ?">
    <meta property="og:description" content="จับไพ่ทาโรต์เพื่อดูว่าใครจะเข้ามาในชีวิตคุณช่วงวาเลนไทน์นี้">
    <meta property="og:image" content="https://pimfahmaprod.github.io/love-tarot/images/card_back_red.png">
    <meta property="og:url" content="https://pimfahmaprod.github.io/love-tarot/">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Valentine Tarot">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ดูดวงความรักวาเลนไทน์ - ใครจะเข้ามาในชีวิตคุณ?">
    <meta name="twitter:description" content="จับไพ่ทาโรต์เพื่อดูว่าใครจะเข้ามาในชีวิตคุณช่วงวาเลนไทน์นี้">
    <meta name="twitter:image" content="https://pimfahmaprod.github.io/love-tarot/images/card_back_red.png">
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;500;600;700&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Prompt:wght@200;300;400;500&family=Dancing+Script:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --burgundy: #722F37;
            --cream: #FFFEF5;
            --cream-dark: #F5F0E1;
            --envelope-cream: #F8F4E8;
            --gold: #C9A227;
        }

        body {
            font-family: 'Prompt', sans-serif;
            font-weight: 300;
            background: repeating-linear-gradient(
                90deg,
                var(--cream) 0px,
                var(--cream) 8px,
                var(--cream-dark) 8px,
                var(--cream-dark) 10px
            );
            min-height: 100vh;
            color: var(--burgundy);
            overflow-x: hidden;
        }

        /* ==================== LANDING PAGE ==================== */
        .landing-heading {
            font-family: 'Caveat', cursive;
            font-size: 2.5rem;
            font-weight: 500;
            color: var(--burgundy);
            text-align: center;
            line-height: 1.3;
            max-width: 350px;
            padding: 0 20px;
            margin-top: 8vh;
            margin-bottom: 0;
            padding-bottom: 2.5rem;
            /* Hidden initially for loading */
            opacity: 0;
            transform: translateY(-40px);
        }

        /* Epic reveal animation for header */
        @keyframes headerReveal {
            0% {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            50% {
                opacity: 1;
                transform: translateY(8px) scale(1.03);
            }
            75% {
                transform: translateY(-3px) scale(1);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .landing-heading.revealed {
            animation: headerReveal 1s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        .strikethrough-word {
            position: relative;
            display: inline-block;
        }

        .strikethrough-word .mistake {
            text-decoration: line-through;
            text-decoration-color: #1a1a1a;
            text-decoration-thickness: 2px;
        }

        .strikethrough-word .valentine {
            position: absolute;
            left: 50%;
            top: 85%;
            transform: translateX(-50%) rotate(-8deg);
            white-space: nowrap;
            font-family: 'Segoe Script', cursive;
            font-size: 1em;
            font-weight: 400;
            color: #1a1a1a;
        }

        .landing-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            z-index: 2000;
            transition: opacity 0.8s ease, visibility 0.8s ease;
            overflow: hidden;
        }

        .landing-page.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        /* Animation for header moving to top-left corner */
        .landing-heading {
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .landing-heading.shrink-to-corner {
            position: fixed;
            top: 15px;
            left: 15px;
            transform: scale(0.4);
            transform-origin: top left;
            font-size: 2.5rem;
            margin: 0;
            padding: 0;
            z-index: 2001;
        }

        /* Animation for spinning card hint fade */
        .spinning-card-container .card-click-hint {
            transition: opacity 0.3s ease;
        }

        /* Ensure spinning card stays above the stack during animation */
        .spinning-card-container {
            z-index: 100;
        }

        /* Card grid - ready state */
        .card-grid.stacked {
            /* Cards are stacked and ready */
        }

        /* Spinning Card Container - Diamond shape spinning on corner */
        .spinning-card-container {
            position: relative;
            width: 180px;
            height: 321px;
            perspective: 1500px;
            cursor: pointer;
            transform-style: preserve-3d;
            margin-top: auto;
            margin-bottom: auto;
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.5s ease;
        }

        .spinning-card-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transform-origin: center center;
            /* Spin around Y-axis (vertical) */
            animation: spinOnY 3s linear infinite;
            transition: transform 0.5s ease;
        }

        .spinning-card {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transform-origin: center center;
            /* Tilt so diagonal (top-left to bottom-right) becomes vertical
               angle = arctan(width/height) = arctan(180/321) ≈ 29.3 degrees */
            transform: rotate(-29.3deg);
            transition: transform 0.5s ease;
        }

        .spinning-card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 12px;
            overflow: hidden;
            box-shadow:
                0 30px 60px rgba(114, 47, 55, 0.5),
                0 15px 40px rgba(0, 0, 0, 0.4);
        }

        .spinning-card-face img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .spinning-card-back {
            transform: rotateY(180deg);
        }

        @keyframes spinOnY {
            0% {
                transform: rotateY(0deg);
            }
            100% {
                transform: rotateY(360deg);
            }
        }

        .spinning-card-container:hover {
            transform: scale(1.05);
        }

        /* Sparkle particles - floating stars */
        .spinning-card-container .sparkle-particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: radial-gradient(circle,
                rgba(255, 255, 255, 1) 0%,
                rgba(255, 215, 0, 0.8) 30%,
                transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            box-shadow: 0 0 6px rgba(255, 215, 0, 0.8);
        }

        @keyframes sparkleRise {
            0% {
                opacity: 0;
                transform: translate(0, 0) scale(0);
            }
            20% {
                opacity: 1;
                transform: translate(calc(var(--move-x) * 0.2), calc(var(--move-y) * 0.2)) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--move-x), var(--move-y)) scale(0.5);
            }
        }

        /* Click hint on card */
        .card-click-hint {
            position: absolute;
            bottom: -60px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Prompt', sans-serif;
            font-weight: 300;
            font-size: 0.9rem;
            color: var(--burgundy);
            opacity: 0.8;
            white-space: nowrap;
        }

        .card-click-hint.loading-state {
            animation: pulse 1.5s ease-in-out infinite;
        }

        /* Ready state animation for hint */
        @keyframes hintReveal {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(10px);
            }
            100% {
                opacity: 0.9;
                transform: translateX(-50%) translateY(0);
            }
        }

        .card-click-hint.ready-state {
            animation: hintReveal 0.6s ease forwards, pulse 2s ease-in-out 0.6s infinite;
        }

        /* Card glow and scale effect when ready */
        @keyframes cardReadyReveal {
            0% {
                transform: scale(1);
                filter: drop-shadow(0 0 0 rgba(201, 162, 39, 0));
            }
            30% {
                transform: scale(1.08);
                filter: drop-shadow(0 0 30px rgba(201, 162, 39, 0.8));
            }
            60% {
                transform: scale(1.02);
                filter: drop-shadow(0 0 20px rgba(201, 162, 39, 0.5));
            }
            100% {
                transform: scale(1);
                filter: drop-shadow(0 0 8px rgba(201, 162, 39, 0.3));
            }
        }

        .spinning-card-container.ready-glow {
            animation: cardReadyReveal 1.2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        /* Persistent subtle glow after ready */
        .spinning-card-container.ready-glow::after {
            content: '';
            position: absolute;
            top: -10%;
            left: -10%;
            width: 120%;
            height: 120%;
            background: radial-gradient(ellipse at center, rgba(201, 162, 39, 0.15) 0%, transparent 70%);
            pointer-events: none;
            z-index: -1;
            animation: subtleGlow 3s ease-in-out infinite;
        }

        @keyframes subtleGlow {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        /* Landing Instruction */
        .landing-instruction {
            display: none;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* Brand on Landing */
        .landing-brand {
            position: absolute;
            bottom: 30px;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.3rem;
            letter-spacing: 3px;
            color: var(--burgundy);
            opacity: 0;
            transition: opacity 0.8s ease;
        }

        .landing-brand.revealed {
            opacity: 1;
        }

        /* ==================== MAIN PAGE ==================== */
        .main-page {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.8s ease 0.5s, visibility 0.8s ease 0.5s;
        }

        .main-page.visible {
            opacity: 1;
            visibility: visible;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header - Hidden */
        header {
            display: none;
        }

        .header-seal {
            width: 45px;
            height: 45px;
            background: var(--burgundy);
            border-radius: 50%;
            margin: 0 auto 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 15px rgba(114, 47, 55, 0.4);
            position: relative;
        }

        .header-seal::before {
            content: '';
            position: absolute;
            width: 35px;
            height: 35px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
        }

        .header-seal-text {
            color: var(--cream);
            font-family: 'Cormorant Garamond', serif;
            font-size: 0.45rem;
            text-align: center;
        }

        .title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.4rem;
            font-style: italic;
            color: var(--burgundy);
        }

        .subtitle {
            display: none;
        }

        .instruction {
            margin-top: 8px;
            font-size: 0.9rem;
            color: var(--burgundy);
        }

        /* Card Grid - Circular Layout */
        .card-grid {
            position: relative;
            width: 100%;
            height: calc(100vh - 80px);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: visible;
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        /* Card */
        .card-container {
            position: absolute;
            width: 80px;
            height: 143px;
            perspective: 1000px;
            cursor: pointer;
            transition: all 0.3s ease;
            transform-origin: center center;
        }

        .card-container:hover {
            z-index: 1000 !important;
        }

        .card-container.disabled {
            pointer-events: none;
            opacity: 0.3;
            transform: scale(0.95);
        }

        .card-container.selecting {
            transform: translateY(-30px);
            opacity: 0;
            transition: all 0.4s ease;
        }

        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(114, 47, 55, 0.15);
        }

        /* Only show shadow on spread cards, not stacked */
        .card-container.spread .card-face {
            box-shadow: 0 4px 15px rgba(114, 47, 55, 0.25);
        }

        /* Stacked cards - minimal individual shadows */
        .card-container.stacked .card-face {
            box-shadow: none;
        }

        /* Stack container shadow - single shadow for whole stack */
        .card-grid.stacked::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90px;
            height: 160px;
            border-radius: 10px;
            box-shadow: 0 15px 40px rgba(114, 47, 55, 0.4), 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: -1;
            pointer-events: none;
        }

        .card-grid.stacked.fade-in::after {
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        .card-grid:not(.stacked)::after {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .card-face img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card-back {
            background: #FFB6C1;
        }

        .card-front {
            transform: rotateY(180deg);
            background: white;
        }


        /* Center Card (Large) */
        .center-card-container {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 280px;
            height: 500px;
            z-index: 1001;
            perspective: 1000px;
            transform: translate(-50%, -150%);
            opacity: 0;
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
        }

        .center-card-container.active {
            transform: translate(-50%, -90%);
            opacity: 1;
        }

        .center-card {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .center-card.flipped {
            transform: rotateY(180deg);
        }

        .center-card .card-face {
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }

        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Result Panel */
        .result-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--cream);
            border-top: 4px solid var(--burgundy);
            border-radius: 30px 30px 0 0;
            padding: 30px;
            z-index: 1002;
            transform: translateY(100%);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .result-panel.active {
            transform: translateY(0);
        }

        .result-card-name {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.8rem;
            text-align: center;
            color: var(--burgundy);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .result-quote {
            font-family: 'Cormorant Garamond', serif;
            font-style: italic;
            font-size: 1.1rem;
            text-align: center;
            color: var(--burgundy);
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(114, 47, 55, 0.05);
            border-radius: 10px;
            border-left: 4px solid var(--burgundy);
        }

        .result-interpretation {
            font-size: 0.95rem;
            line-height: 1.8;
            color: var(--burgundy);
            text-align: left;
            white-space: pre-line;
            max-width: 600px;
            margin: 0 auto;
        }

        .retry-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin: 25px auto 0;
            font-family: 'Prompt', sans-serif;
        }

        .retry-text {
            font-weight: 300;
            font-size: 0.9rem;
            color: var(--burgundy);
            opacity: 0.7;
        }

        .result-close {
            display: inline-block;
            padding: 6px 16px;
            font-family: 'Prompt', sans-serif;
            font-weight: 400;
            font-size: 0.9rem;
            background: var(--burgundy);
            color: var(--cream);
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .result-close:hover {
            background: #5a252c;
            transform: scale(1.05);
        }

        /* Share Buttons */
        .share-section {
            margin-top: 20px;
            text-align: center;
        }

        .share-label {
            font-family: 'Prompt', sans-serif;
            font-weight: 300;
            font-size: 0.9rem;
            color: var(--burgundy);
            margin-bottom: 12px;
            opacity: 0.8;
        }

        .share-buttons {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .share-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }

        .share-btn:hover {
            transform: scale(1.1);
        }

        .share-btn.facebook {
            background: #1877F2;
            color: white;
        }

        .share-btn.line {
            background: #00B900;
            color: white;
        }

        .share-btn svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        /* Save Buttons */
        .save-section {
            margin-top: 15px;
            text-align: center;
        }

        .save-label {
            font-family: 'Prompt', sans-serif;
            font-weight: 300;
            font-size: 0.9rem;
            color: var(--burgundy);
            margin-bottom: 10px;
            opacity: 0.8;
        }

        .save-buttons {
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .save-btn {
            padding: 8px 14px;
            border-radius: 20px;
            border: 1.5px solid var(--burgundy);
            background: transparent;
            color: var(--burgundy);
            cursor: pointer;
            font-family: 'Prompt', sans-serif;
            font-weight: 300;
            font-size: 0.75rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .save-btn:hover {
            background: var(--burgundy);
            color: var(--cream);
        }

        .save-btn svg {
            width: 14px;
            height: 14px;
            fill: currentColor;
        }

        .save-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .save-label-inline {
            font-family: 'Prompt', sans-serif;
            font-weight: 300;
            font-size: 0.85rem;
            color: var(--burgundy);
            opacity: 0.8;
        }

        .save-btn.icon-only {
            padding: 8px 10px;
        }

        .save-btn.icon-only svg {
            width: 18px;
            height: 18px;
        }

        .save-btn.with-text {
            padding: 6px 12px;
        }

        .save-btn.with-text svg {
            width: 14px;
            height: 14px;
        }

        .copy-toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: var(--burgundy);
            color: var(--cream);
            padding: 12px 24px;
            border-radius: 30px;
            font-family: 'Prompt', sans-serif;
            font-weight: 300;
            font-size: 0.9rem;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 2000;
        }

        .copy-toast.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 10px 20px;
            color: var(--burgundy);
            font-family: 'Cormorant Garamond', serif;
        }

        .brand {
            font-size: 1rem;
            letter-spacing: 2px;
            opacity: 0.7;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2rem;
            color: var(--burgundy);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .envelope-container {
                width: 85vw;
                height: 60vw;
                max-width: none;
                max-height: none;
            }

            .wax-seal {
                width: 110px;
                height: 110px;
            }

            .wax-seal::before {
                width: 85px;
                height: 85px;
            }

            .landing-heading {
                font-size: 2.2rem;
                max-width: 300px;
                margin-top: 6vh;
            }

            .spinning-card-container {
                width: 150px;
                height: 268px;
            }

            .card-click-hint {
                font-size: 0.85rem;
                bottom: -50px;
            }

            .title {
                font-size: 1.2rem;
            }

            header {
                padding: 10px 15px 5px;
            }

            .card-grid {
                height: calc(100vh - 60px);
            }

            .card-grid.stacked::after {
                width: 70px;
                height: 125px;
            }

            footer {
                padding: 5px 15px;
            }

            .center-card-container {
                width: 240px;
                height: 429px;
            }

            .result-panel {
                padding: 20px;
            }

            .result-card-name {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .envelope-container {
                width: 90vw;
                height: 63vw;
            }

            .wax-seal {
                width: 95px;
                height: 95px;
            }

            .wax-seal::before {
                width: 72px;
                height: 72px;
            }

            .landing-heading {
                font-size: 2.3rem;
                max-width: 280px;
                margin-top: 8vh;
            }

            .spinning-card-container {
                width: 180px;
                height: 321px;
            }

            .card-click-hint {
                font-size: 0.8rem;
                bottom: -50px;
            }

            header {
                padding: 8px 10px 3px;
            }

            .header-seal {
                width: 35px;
                height: 35px;
                margin-bottom: 5px;
            }

            .header-seal::before {
                width: 28px;
                height: 28px;
            }

            .title {
                font-size: 1rem;
            }

            .instruction {
                font-size: 0.8rem;
                margin-top: 5px;
            }

            .card-grid {
                height: calc(100vh - 50px);
            }

            .card-grid.stacked::after {
                width: 55px;
                height: 100px;
            }

            footer {
                padding: 5px 10px;
            }

            .brand {
                font-size: 0.85rem;
            }

            .center-card-container {
                width: 200px;
                height: 357px;
            }
        }
    </style>
</head>
<body>
    <!-- Landing Page -->
    <div class="landing-page" id="landingPage">
        <h1 class="landing-heading">Who's Gonna Be My Next <span class="strikethrough-word"><span class="mistake">Mistake?</span><span class="valentine">Valentine!</span></span></h1>
        <div class="spinning-card-container" id="spinningCardContainer">
            <div class="spinning-card-wrapper">
                <div class="spinning-card" id="spinningCard">
                    <div class="spinning-card-face spinning-card-front">
                        <img id="spinningCardFront" src="images/tarot/THE LOVERS.png" alt="Tarot Card Front">
                    </div>
                    <div class="spinning-card-face spinning-card-back">
                        <img src="images/card_back_red.png" alt="Card Back">
                    </div>
                </div>
            </div>
            <span class="card-click-hint loading-state">กำลังโหลด...</span>
        </div>
        <p class="landing-instruction">ใครจะเข้ามาในชีวิตคุณช่วงวาเลนไทน์?</p>
        <p class="landing-brand">Pimfahmaprod</p>
    </div>

    <!-- Main Page -->
    <div class="main-page" id="mainPage">
        <div class="container">
            <header>
                <div class="header-seal">
                    <span class="header-seal-text">Valentine<br>Tarot</span>
                </div>
                <h1 class="title">ใครจะเข้ามาในชีวิตคุณช่วงวาเลนไทน์</h1>
                <p class="subtitle">"The Tastemaker Dictionary for Curation"</p>
                <p class="instruction">เลือกไพ่ 1 ใบ เพื่อดูคำทำนาย</p>
            </header>

            <div class="card-grid" id="cardGrid">
                <div class="loading">กำลังโหลดไพ่...</div>
            </div>

            <footer>
                <p class="brand">Pimfahmaprod</p>
            </footer>
        </div>
    </div>

    <!-- Flash Overlay -->
    <div class="flash-overlay" id="flashOverlay"></div>

    <!-- Card Burst Container -->
    <div class="card-burst-container" id="cardBurstContainer"></div>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <!-- Center Card (Large) -->
    <div class="center-card-container" id="centerCard">
        <div class="center-card" id="centerCardInner">
            <div class="card-face card-back">
                <img src="images/card_back_red.png" alt="Card Back">
            </div>
            <div class="card-face card-front">
                <img id="centerCardImage" src="" alt="Card">
            </div>
        </div>
    </div>

    <!-- Result Panel -->
    <div class="result-panel" id="resultPanel">
        <h3 class="result-card-name" id="resultCardName"></h3>
        <p class="result-quote" id="resultQuote"></p>
        <p class="result-interpretation" id="resultInterpretation"></p>

        <!-- Save Image Buttons -->
        <div class="save-section">
            <div class="save-row">
                <span class="save-label-inline">เซฟรูป :</span>
                <button class="save-btn with-text" onclick="saveImage('ig-story')" title="Instagram Story (9:16)">
                    <svg viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                    <span>Story</span>
                </button>
                <button class="save-btn with-text" onclick="saveImage('square')" title="Instagram Square (1:1)">
                    <svg viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                    <span>Post</span>
                </button>
                <button class="save-btn icon-only" onclick="saveImage('facebook')" title="Facebook">
                    <svg viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                </button>
                <button class="save-btn icon-only" onclick="saveImage('wide')" title="รูปกว้าง">
                    <svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
                </button>
            </div>
        </div>

        <!-- Share Buttons -->
        <div class="share-section">
            <div class="save-row">
                <span class="save-label-inline">บอกต่อ :</span>
                <button class="save-btn icon-only" onclick="shareToFacebook()" title="ส่งทาง Messenger">
                    <svg viewBox="0 0 28 28"><path d="M14 0C6.268 0 0 5.842 0 13.053c0 4.106 2.007 7.77 5.143 10.163V28l4.638-2.548c1.236.343 2.545.528 3.919.528 7.732 0 14-5.842 14-13.053S21.732 0 14 0zm1.392 17.576l-3.567-3.805-6.962 3.805 7.659-8.132 3.654 3.805 6.875-3.805-7.659 8.132z"/></svg>
                </button>
                <button class="save-btn icon-only" onclick="shareToLine()" title="ส่งทาง LINE">
                    <svg viewBox="0 0 24 24"><path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.349 0 .63.285.63.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/></svg>
                </button>
                <button class="save-btn with-text" onclick="copyLink()" title="คัดลอกลิงก์">
                    <svg viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>
                    <span>คัดลอก</span>
                </button>
            </div>
        </div>

        <div class="retry-row">
            <span class="retry-text">ยังไม่เอาจริง</span>
            <button class="result-close" id="resultClose">จับใหม่</button>
        </div>
    </div>

    <!-- Copy Toast -->
    <div class="copy-toast" id="copyToast">คัดลอกลิงก์แล้ว!</div>

    <script>
        let tarotData = null;
        let selectedCardElement = null;
        let isAnimating = false;
        let isPageReady = false;

        // Preload an image and return a promise
        function preloadImage(src) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(src);
                img.onerror = () => resolve(src); // Don't fail on error, just continue
                img.src = src;
            });
        }

        // Mark page as ready and enable card clicking with epic reveal
        function markPageReady() {
            isPageReady = true;

            // Reveal the header with epic animation
            const header = document.querySelector('.landing-heading');
            if (header) {
                header.classList.add('revealed');
            }

            // Add glow effect to card
            const cardContainer = document.getElementById('spinningCardContainer');
            if (cardContainer) {
                cardContainer.classList.add('ready-glow');
            }

            // Update hint text with ready animation (after header animation)
            setTimeout(() => {
                const hintText = document.querySelector('.card-click-hint');
                if (hintText) {
                    hintText.textContent = 'แตะไพ่เพื่อเริ่มดูดวง';
                    hintText.classList.remove('loading-state');
                    hintText.classList.add('ready-state');
                }

                // Reveal brand at bottom
                const brand = document.querySelector('.landing-brand');
                if (brand) {
                    brand.classList.add('revealed');
                }
            }, 600);
        }

        // Wait for all resources to load
        async function waitForResources() {
            // Start the card rotation animation immediately
            startCardRotation();
            createFloatingSparkles();

            // Wait for fonts
            if (document.fonts && document.fonts.ready) {
                await document.fonts.ready;
            }

            // Wait for tarot data to load first
            if (!tarotData) {
                try {
                    const response = await fetch('valentine_tarot.json');
                    tarotData = await response.json();
                } catch (error) {
                    console.error('Error loading tarot data:', error);
                }
            }

            // Collect all images to preload
            const imagesToPreload = [
                'images/card_back_red.png',
                'images/website_theme.jpg',
                ...spinningCardImages
            ];

            // Add all tarot card images from data
            if (tarotData && tarotData.cards) {
                tarotData.cards.forEach(card => {
                    imagesToPreload.push(`images/tarot/${card.image}`);
                });
            }

            // Preload all images
            await Promise.all(imagesToPreload.map(src => preloadImage(src)));

            // Render cards after images are loaded
            renderCards();

            // Small delay for smooth transition
            await new Promise(resolve => setTimeout(resolve, 300));

            // Mark page as ready and enable clicking
            markPageReady();
        }

        // Card images for spinning display
        const spinningCardImages = [
            'images/tarot/THE LOVERS.png',
            'images/tarot/THE STAR.png',
            'images/tarot/THE SUN.png',
            'images/tarot/THE MOON.png',
            'images/tarot/THE EMPRESS.png',
            'images/tarot/THE EMPEROR.png',
            'images/tarot/WHEEL OF FORTUNE.png',
            'images/tarot/THE MAGICIAN.png',
            'images/tarot/THE HIGH PRIESTRESS.png',
            'images/tarot/STRENGTH.png'
        ];

        let currentSpinningCardIndex = 0;
        let spinningCardInterval = null;

        // Change the front card image during rotation
        function startCardRotation() {
            const frontImg = document.getElementById('spinningCardFront');

            // Wait 1.5s (when back is facing) then change image every 3s (full rotation)
            // This ensures image changes when back is facing, not when front is visible
            setTimeout(() => {
                // First change at 1.5s (back facing)
                currentSpinningCardIndex = (currentSpinningCardIndex + 1) % spinningCardImages.length;
                frontImg.src = spinningCardImages[currentSpinningCardIndex];

                // Then change every 3s (one full rotation, always when back is facing)
                spinningCardInterval = setInterval(() => {
                    currentSpinningCardIndex = (currentSpinningCardIndex + 1) % spinningCardImages.length;
                    frontImg.src = spinningCardImages[currentSpinningCardIndex];
                }, 3000);
            }, 1500);
        }

        // Create floating sparkles around spinning card
        let sparkleInterval = null;
        function createFloatingSparkles() {
            const container = document.getElementById('spinningCardContainer');

            sparkleInterval = setInterval(() => {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle-particle';

                // Random position in a circle around the center
                const angle = Math.random() * Math.PI * 2;
                const radius = 100 + Math.random() * 60;
                const x = 90 + Math.cos(angle) * radius;
                const y = 160 + Math.sin(angle) * radius;

                // Random movement direction
                const moveX = (Math.random() - 0.5) * 40;
                const moveY = -20 - Math.random() * 30; // Float upward
                const duration = 1.5 + Math.random() * 1;
                const size = 3 + Math.random() * 5;

                sparkle.style.cssText = `
                    left: ${x}px;
                    top: ${y}px;
                    width: ${size}px;
                    height: ${size}px;
                    animation: sparkleRise ${duration}s ease-out forwards;
                    --move-x: ${moveX}px;
                    --move-y: ${moveY}px;
                `;

                container.appendChild(sparkle);

                // Remove after animation
                setTimeout(() => sparkle.remove(), duration * 1000);
            }, 200);
        }

        function stopFloatingSparkles() {
            if (sparkleInterval) {
                clearInterval(sparkleInterval);
                sparkleInterval = null;
            }
        }

        // Create sparkles
        function createSparkles(centerX, centerY) {
            const container = document.getElementById('cardBurstContainer');

            for (let i = 0; i < 25; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';

                const angle = Math.random() * Math.PI * 2;
                const distance = 150 + Math.random() * 250;
                const sx = Math.cos(angle) * distance;
                const sy = Math.sin(angle) * distance - 100;

                sparkle.style.cssText = `
                    left: ${centerX}px;
                    top: ${centerY}px;
                    --sx: ${sx}px;
                    --sy: ${sy}px;
                    animation-delay: ${Math.random() * 300}ms;
                    width: ${4 + Math.random() * 8}px;
                    height: ${4 + Math.random() * 8}px;
                `;

                container.appendChild(sparkle);

                setTimeout(() => {
                    sparkle.classList.add('animate');
                }, Math.random() * 300);
            }
        }

        // Create flying cards burst effect
        function createCardBurst() {
            const container = document.getElementById('cardBurstContainer');
            const flashOverlay = document.getElementById('flashOverlay');
            const cardRect = document.getElementById('spinningCardContainer').getBoundingClientRect();
            const centerX = cardRect.left + cardRect.width / 2;
            const centerY = cardRect.top + cardRect.height / 2;

            // Trigger flash effect
            flashOverlay.classList.add('active');
            setTimeout(() => {
                flashOverlay.classList.remove('active');
            }, 600);

            // Create sparkles
            createSparkles(centerX, centerY);

            // Create 14 flying cards
            for (let i = 0; i < 14; i++) {
                const card = document.createElement('div');
                card.className = 'flying-card';

                // Alternate between card back and front
                const imgSrc = i % 2 === 0 ? 'images/card_back_red.png' : spinningCardImages[i % spinningCardImages.length];
                card.innerHTML = `<img src="${imgSrc}" alt="Flying Card">`;

                // Random direction for burst effect
                const angle = (i / 14) * Math.PI * 2 + (Math.random() - 0.5) * 0.5;
                const distance = 180 + Math.random() * 120;
                const endDistance = 500 + Math.random() * 350;

                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;
                const txEnd = Math.cos(angle) * endDistance;
                const tyEnd = Math.sin(angle) * endDistance - 200;
                const rot = (Math.random() - 0.5) * 60;
                const rotEnd = rot + (Math.random() - 0.5) * 180;

                card.style.cssText = `
                    left: ${centerX}px;
                    top: ${centerY}px;
                    --tx: ${tx}px;
                    --ty: ${ty}px;
                    --tx-end: ${txEnd}px;
                    --ty-end: ${tyEnd}px;
                    --rot: ${rot}deg;
                    --rot-end: ${rotEnd}deg;
                    animation-delay: ${i * 40}ms;
                `;

                container.appendChild(card);

                setTimeout(() => {
                    card.classList.add('animate');
                }, 10 + i * 40);
            }

            // Clean up after animation
            setTimeout(() => {
                container.innerHTML = '';
            }, 2000);
        }

        // Start the experience (when card is clicked)
        function startExperience() {
            // Don't allow starting if page is not ready yet
            if (!isPageReady) {
                return;
            }

            const spinningCard = document.getElementById('spinningCard');
            const spinningCardContainer = document.getElementById('spinningCardContainer');
            const spinningCardWrapper = spinningCardContainer.querySelector('.spinning-card-wrapper');
            const landingPage = document.getElementById('landingPage');
            const mainPage = document.getElementById('mainPage');
            const landingHeading = document.querySelector('.landing-heading');
            const cardGrid = document.getElementById('cardGrid');

            // Get stack card size for target shrink
            const { cardWidth, cardHeight } = getEllipseParams();

            // Stop the rotation interval and sparkles
            if (spinningCardInterval) {
                clearInterval(spinningCardInterval);
            }
            stopFloatingSparkles();

            // Step 1: Stop spinning and show back of card with smooth transition
            spinningCardWrapper.style.transition = 'transform 0.5s ease-out';
            spinningCardWrapper.style.animation = 'none';
            spinningCardWrapper.style.transform = 'rotateY(180deg)';

            // Step 2: Straighten the card (remove tilt)
            spinningCard.style.transition = 'transform 0.5s ease-out';
            spinningCard.style.transform = 'rotate(0deg)';

            // Hide hint text
            spinningCardContainer.querySelector('.card-click-hint').style.opacity = '0';

            // Animate header to top-left corner
            landingHeading.classList.add('shrink-to-corner');

            // Hide other landing elements
            setTimeout(() => {
                document.querySelector('.landing-brand').style.opacity = '0';
                document.querySelector('.landing-instruction').style.opacity = '0';
            }, 200);

            // Prepare main page and card grid (hidden behind spinning card)
            setTimeout(() => {
                landingPage.style.pointerEvents = 'none';
                cardGrid.classList.add('stacked');
                // Don't add initial-hidden - cards will be behind the spinning card
                mainPage.classList.add('visible');
            }, 400);

            // Step 3: Shrink the card in place using transform scale
            setTimeout(() => {
                // Calculate scale to match stack card size
                const currentWidth = spinningCardContainer.offsetWidth;
                const scale = cardWidth / currentWidth;

                spinningCardContainer.style.transition = 'transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                spinningCardContainer.style.transform = `scale(${scale})`;

                // Also reduce shadow on the card face
                const cardFaces = spinningCardContainer.querySelectorAll('.spinning-card-face');
                cardFaces.forEach(face => {
                    face.style.transition = 'box-shadow 0.6s ease';
                    face.style.boxShadow = '0 2px 8px rgba(114, 47, 55, 0.15)';
                });
            }, 500);

            // Step 4: After shrink completes, hide spinning card instantly and spread the stack
            setTimeout(() => {
                // Hide spinning card instantly with NO transition - it should just disappear
                // The stack is already visible behind at the same position
                spinningCardContainer.style.transition = 'none';
                spinningCardContainer.style.opacity = '0';
                spinningCardContainer.style.visibility = 'hidden';

                // Small delay before spreading to make it feel like the top card is part of the stack
                setTimeout(() => {
                    cardGrid.classList.remove('stacked');
                    animateToEllipse();
                }, 50);

                // Move header outside landing page and hide landing
                setTimeout(() => {
                    document.body.appendChild(landingHeading);
                    landingPage.classList.add('hidden');
                }, 300);
            }, 1100);
        }

        // Load tarot data
        async function loadTarotData() {
            try {
                const response = await fetch('valentine_tarot.json');
                tarotData = await response.json();
                renderCards();
            } catch (error) {
                console.error('Error loading tarot data:', error);
                document.getElementById('cardGrid').innerHTML =
                    '<p class="loading">ไม่สามารถโหลดข้อมูลไพ่ได้</p>';
            }
        }

        // Shuffle array
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Expand cards to 78
        function expandCardsTo78(cards) {
            const targetCount = 78;
            const baseCount = cards.length; // 22
            const timesEach = Math.floor(targetCount / baseCount); // 3
            const remainder = targetCount % baseCount; // 12

            let expanded = [];

            // Add each card 'timesEach' times (3 times each = 66 cards)
            for (let i = 0; i < timesEach; i++) {
                expanded = expanded.concat(cards);
            }

            // Add 'remainder' more cards randomly (12 more to reach 78)
            const shuffledForExtra = shuffleArray([...cards]);
            for (let i = 0; i < remainder; i++) {
                expanded.push(shuffledForExtra[i]);
            }

            return expanded;
        }

        // Render cards
        function renderCards() {
            const cardGrid = document.getElementById('cardGrid');
            const expandedCards = expandCardsTo78(tarotData.cards);
            const shuffledCards = shuffleArray(expandedCards);

            cardGrid.innerHTML = shuffledCards.map((card, index) => `
                <div class="card-container" data-card-id="${card.id}">
                    <div class="card">
                        <div class="card-face card-back">
                            <img src="images/card_back_red.png" alt="Card Back">
                        </div>
                        <div class="card-face card-front">
                            <img src="images/tarot/${card.image}" alt="${card.name}">
                        </div>
                    </div>
                </div>
            `).join('');

            // Add click listeners and hover effects
            document.querySelectorAll('.card-container').forEach((container, index) => {
                container.addEventListener('click', () => {
                    const cardId = parseInt(container.dataset.cardId);
                    selectCard(cardId, container);
                });

                // Store original transform for hover effects
                container.dataset.index = index;

                container.addEventListener('mouseenter', () => {
                    if (!container.classList.contains('selecting') && !container.classList.contains('disabled')) {
                        const originalTransform = getCardTransform(index);
                        container.style.transform = `${originalTransform} scale(1.4)`;
                        container.style.zIndex = '1000';
                    }
                });

                container.addEventListener('mouseleave', () => {
                    if (!container.classList.contains('selecting') && !container.classList.contains('disabled')) {
                        const originalTransform = getCardTransform(index);
                        container.style.transform = originalTransform;
                        container.style.zIndex = index;
                    }
                });
            });

            // Apply stacked layout initially (animation triggered later)
            applyStackedLayout();
        }

        // Apply stacked layout (initial state)
        function applyStackedLayout() {
            const containers = document.querySelectorAll('.card-container');
            const { cardWidth, cardHeight } = getEllipseParams();

            containers.forEach((container, index) => {
                // Small random offset for natural stack look
                const offsetX = (Math.random() - 0.5) * 6;
                const offsetY = (Math.random() - 0.5) * 3;
                const rotation = (Math.random() - 0.5) * 8;

                container.classList.add('stacked');
                container.classList.remove('spread');
                container.style.width = `${cardWidth}px`;
                container.style.height = `${cardHeight}px`;
                container.style.left = `calc(50% - ${cardWidth/2}px + ${offsetX}px)`;
                container.style.top = `calc(50% - ${cardHeight/2}px + ${offsetY}px)`;
                container.style.transform = `rotate(${rotation}deg)`;
                container.style.zIndex = index;
                container.style.transition = 'none';
            });
        }

        // Animate cards from stack to ellipse
        function animateToEllipse() {
            const containers = document.querySelectorAll('.card-container');
            const totalCards = containers.length;
            const { radiusX, radiusY, cardWidth, cardHeight, offsetY } = getEllipseParams();

            containers.forEach((container, index) => {
                // Stagger the animation
                const delay = index * 15;

                setTimeout(() => {
                    container.classList.remove('stacked');
                    container.classList.add('spread');
                    container.style.transition = 'all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)';

                    const anglePerCard = (2 * Math.PI) / totalCards;
                    const angle = index * anglePerCard - Math.PI / 2;

                    const x = radiusX * Math.cos(angle);
                    const y = radiusY * Math.sin(angle) + offsetY;
                    const rotationDeg = (angle * 180 / Math.PI) + 90;

                    container.style.left = `calc(50% + ${x}px - ${cardWidth/2}px)`;
                    container.style.top = `calc(50% + ${y}px - ${cardHeight/2}px)`;
                    container.style.transform = `rotate(${rotationDeg}deg)`;
                    container.style.zIndex = index;

                    // Reset transition after animation
                    setTimeout(() => {
                        container.style.transition = 'all 0.3s ease';
                    }, 600);
                }, delay);
            });
        }

        // Get responsive elliptical parameters
        function getEllipseParams() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            if (width <= 480) {
                // Mobile: tall ellipse along screen height
                return {
                    radiusX: Math.min(width * 0.38, 150),   // Narrow horizontal
                    radiusY: Math.min(height * 0.32, 220),  // Tall vertical
                    cardWidth: 40,
                    cardHeight: 71,
                    offsetY: 0
                };
            } else if (width <= 768) {
                return {
                    radiusX: 160,   // Narrow
                    radiusY: 280,   // Tall
                    cardWidth: 50,
                    cardHeight: 89,
                    offsetY: 0
                };
            }
            return {
                radiusX: 200,   // Narrow
                radiusY: 380,   // Very tall
                cardWidth: 65,
                cardHeight: 116,
                offsetY: 0
            };
        }

        // Get card transform based on index for elliptical layout
        function getCardTransform(index) {
            const totalCards = 78;
            const anglePerCard = (2 * Math.PI) / totalCards;
            const angle = index * anglePerCard - Math.PI / 2; // Start from top
            const rotationDeg = (angle * 180 / Math.PI) + 90; // Point outward
            return `rotate(${rotationDeg}deg)`;
        }

        // Apply elliptical layout
        function applyCircularLayout() {
            const containers = document.querySelectorAll('.card-container');
            const totalCards = containers.length;
            const { radiusX, radiusY, cardWidth, cardHeight, offsetY } = getEllipseParams();

            containers.forEach((container, index) => {
                const anglePerCard = (2 * Math.PI) / totalCards;
                const angle = index * anglePerCard - Math.PI / 2; // Start from top

                // Calculate position on ellipse
                const x = radiusX * Math.cos(angle);
                const y = radiusY * Math.sin(angle) + offsetY;

                // Rotation to point outward from center
                const rotationDeg = (angle * 180 / Math.PI) + 90;

                container.style.width = `${cardWidth}px`;
                container.style.height = `${cardHeight}px`;
                container.style.left = `calc(50% + ${x}px - ${cardWidth/2}px)`;
                container.style.top = `calc(50% + ${y}px - ${cardHeight/2}px)`;
                container.style.transformOrigin = 'center center';
                container.style.transform = `rotate(${rotationDeg}deg)`;
                container.style.zIndex = index;
            });
        }

        // Select card
        function selectCard(cardId, cardElement) {
            if (isAnimating) return;
            isAnimating = true;

            const card = tarotData.cards.find(c => c.id === cardId);
            if (!card) {
                isAnimating = false;
                return;
            }

            selectedCardElement = cardElement;

            // Set center card image
            document.getElementById('centerCardImage').src = `images/tarot/${card.image}`;

            // Reset center card flip state
            document.getElementById('centerCardInner').classList.remove('flipped');

            // Step 1: Selected card slides up and fades out
            cardElement.classList.add('selecting');

            // Disable other cards
            document.querySelectorAll('.card-container').forEach(c => {
                if (c !== cardElement) {
                    c.classList.add('disabled');
                }
            });

            // Step 2: Show overlay and center card slides down
            setTimeout(() => {
                document.getElementById('overlay').classList.add('active');
                document.getElementById('centerCard').classList.add('active');

                // Step 3: Flip center card
                setTimeout(() => {
                    document.getElementById('centerCardInner').classList.add('flipped');

                    // Step 4: Show result panel
                    setTimeout(() => {
                        currentCardData = card; // Store for save image
                        document.getElementById('resultCardName').textContent = card.name;
                        document.getElementById('resultQuote').textContent = `"${card.quote}"`;
                        document.getElementById('resultInterpretation').textContent = card.interpretation;
                        document.getElementById('resultPanel').classList.add('active');
                        isAnimating = false;
                    }, 800);
                }, 500);
            }, 400);
        }

        // Close and reset
        function closeResult() {
            if (isAnimating) return;
            isAnimating = true;

            const cardGrid = document.getElementById('cardGrid');

            // Hide result panel
            document.getElementById('resultPanel').classList.remove('active');

            setTimeout(() => {
                // Hide center card
                document.getElementById('centerCard').classList.remove('active');

                // Hide overlay
                document.getElementById('overlay').classList.remove('active');

                // Reshuffle and re-render
                setTimeout(() => {
                    cardGrid.classList.add('stacked');
                    renderCards();
                    selectedCardElement = null;
                    isAnimating = false;

                    // Animate cards from stack to fan
                    setTimeout(() => {
                        cardGrid.classList.remove('stacked');
                        animateToEllipse();
                    }, 100);
                }, 400);
            }, 300);
        }

        // Event listeners
        document.getElementById('spinningCardContainer').addEventListener('click', startExperience);
        document.getElementById('resultClose').addEventListener('click', closeResult);

        // Keyboard support
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeResult();
            }
            if (e.key === 'Enter' || e.key === ' ') {
                const landingPage = document.getElementById('landingPage');
                if (!landingPage.classList.contains('hidden')) {
                    startExperience();
                }
            }
        });

        // Handle window resize
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                applyCircularLayout();
            }, 100);
        });

        // Share Functions
        const siteUrl = 'https://pimfahmaprod.github.io/love-tarot/';

        function getShareText() {
            const cardName = document.getElementById('resultCardName').textContent;
            const quote = document.getElementById('resultQuote').textContent.replace(/[""]/g, '');
            return `ฉันจับได้ไพ่ ${cardName}\n"${quote}"\n\nมาดูดวงความรักวาเลนไทน์กัน!`;
        }

        function showToast(message) {
            const toast = document.getElementById('copyToast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2500);
        }

        // Try Web Share API first (best for mobile)
        function tryWebShare() {
            if (navigator.share) {
                navigator.share({
                    title: 'ดูดวงความรักวาเลนไทน์',
                    text: getShareText(),
                    url: siteUrl
                }).catch(() => {});
                return true;
            }
            return false;
        }

        function shareToFacebook() {
            // Share to Facebook Messenger
            const text = getShareText() + '\n\n' + siteUrl;
            navigator.clipboard.writeText(text).then(() => {
                showToast('คัดลอกข้อความแล้ว! วางใน Messenger ได้เลย');
                setTimeout(() => {
                    // Try Messenger deep link first (works on mobile), fallback to web
                    const messengerUrl = `https://www.facebook.com/dialog/send?link=${encodeURIComponent(siteUrl)}&redirect_uri=${encodeURIComponent(siteUrl)}`;
                    window.open(messengerUrl, '_blank', 'width=600,height=400');
                }, 500);
            });
        }

        function shareToLine() {
            // LINE already opens chat/messaging
            const text = encodeURIComponent(getShareText() + '\n' + siteUrl);
            window.open(`https://line.me/R/share?text=${text}`, '_blank', 'width=600,height=400');
        }

        function copyLink() {
            const text = getShareText() + '\n\n' + siteUrl;
            navigator.clipboard.writeText(text).then(() => {
                showToast('คัดลอกข้อความแล้ว!');
            });
        }

        // Save Image Functions
        let currentCardData = null;

        function saveImage(platform) {
            if (!currentCardData) {
                showToast('กรุณาเลือกไพ่ก่อน');
                return;
            }

            const sizes = {
                'ig-story': { width: 1080, height: 1920 },
                'square': { width: 1080, height: 1080 },
                'facebook': { width: 1200, height: 630 },
                'wide': { width: 1200, height: 630 }
            };

            const size = sizes[platform];
            if (!size) return;

            showToast('กำลังสร้างรูป...');

            const canvas = document.createElement('canvas');
            canvas.width = size.width;
            canvas.height = size.height;
            const ctx = canvas.getContext('2d');

            // Load card image
            const cardImg = new Image();
            cardImg.crossOrigin = 'anonymous';
            cardImg.onload = () => {
                drawShareImage(ctx, cardImg, size, platform);

                // Download
                const link = document.createElement('a');
                link.download = `valentine-tarot-${currentCardData.name.toLowerCase().replace(/\s+/g, '-')}-${platform}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();

                showToast('บันทึกรูปสำเร็จ!');
            };
            cardImg.onerror = () => {
                // Draw without card image
                drawShareImage(ctx, null, size, platform);

                const link = document.createElement('a');
                link.download = `valentine-tarot-${currentCardData.name.toLowerCase().replace(/\s+/g, '-')}-${platform}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();

                showToast('บันทึกรูปสำเร็จ!');
            };
            cardImg.src = `images/tarot/${currentCardData.image}`;
        }

        function drawShareImage(ctx, cardImg, size, platform) {
            const { width, height } = size;
            const isVertical = height > width;
            const isWide = width > height;

            // Background gradient
            const gradient = ctx.createLinearGradient(0, 0, width, height);
            gradient.addColorStop(0, '#FDF8F3');
            gradient.addColorStop(0.5, '#FAF0E6');
            gradient.addColorStop(1, '#F5E6D3');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);

            // Decorative border
            ctx.strokeStyle = '#722F37';
            ctx.lineWidth = isWide ? 6 : 8;
            const borderPadding = isWide ? 20 : 30;
            ctx.strokeRect(borderPadding, borderPadding, width - borderPadding * 2, height - borderPadding * 2);

            // Inner decorative line
            ctx.strokeStyle = 'rgba(114, 47, 55, 0.3)';
            ctx.lineWidth = 2;
            const innerPadding = borderPadding + 15;
            ctx.strokeRect(innerPadding, innerPadding, width - innerPadding * 2, height - innerPadding * 2);

            // Layout based on platform
            if (isVertical) {
                // Story layout (vertical)
                drawVerticalLayout(ctx, cardImg, width, height);
            } else if (isWide) {
                // Facebook layout (wide)
                drawWideLayout(ctx, cardImg, width, height);
            } else {
                // Square layout (IG post, LINE)
                drawSquareLayout(ctx, cardImg, width, height);
            }
        }

        // Draw social media icons (4 icons: IG, TikTok, FB, YouTube)
        function drawSocialIcons(ctx, x, y, size, color) {
            ctx.fillStyle = color;
            ctx.strokeStyle = color;
            ctx.lineWidth = size * 0.07;

            const gap = size * 1.4; // Gap between icons
            let currentX = x;
            const radius = size * 0.2;

            // Instagram icon
            ctx.beginPath();
            ctx.roundRect(currentX, y, size, size, radius);
            ctx.stroke();
            ctx.beginPath();
            ctx.arc(currentX + size/2, y + size/2, size * 0.28, 0, Math.PI * 2);
            ctx.stroke();
            ctx.beginPath();
            ctx.arc(currentX + size * 0.75, y + size * 0.25, size * 0.07, 0, Math.PI * 2);
            ctx.fill();

            currentX += gap;

            // TikTok icon
            ctx.beginPath();
            ctx.roundRect(currentX, y, size, size, radius);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(currentX + size * 0.58, y + size * 0.15);
            ctx.lineTo(currentX + size * 0.58, y + size * 0.65);
            ctx.stroke();
            ctx.beginPath();
            ctx.arc(currentX + size * 0.42, y + size * 0.7, size * 0.18, 0, Math.PI * 2);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(currentX + size * 0.58, y + size * 0.22);
            ctx.quadraticCurveTo(currentX + size * 0.85, y + size * 0.18, currentX + size * 0.85, y + size * 0.38);
            ctx.stroke();

            currentX += gap;

            // Facebook icon
            ctx.beginPath();
            ctx.roundRect(currentX, y, size, size, radius);
            ctx.stroke();
            ctx.font = `bold ${size * 0.65}px Arial`;
            ctx.textAlign = 'center';
            ctx.fillText('f', currentX + size/2, y + size * 0.72);

            currentX += gap;

            // Youtube icon
            ctx.beginPath();
            ctx.roundRect(currentX, y, size, size, radius);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(currentX + size * 0.38, y + size * 0.3);
            ctx.lineTo(currentX + size * 0.38, y + size * 0.7);
            ctx.lineTo(currentX + size * 0.72, y + size * 0.5);
            ctx.closePath();
            ctx.fill();

            return currentX + size;
        }

        // Draw LINE icon only
        function drawLineIcon(ctx, x, y, size, color) {
            ctx.fillStyle = color;
            ctx.strokeStyle = color;
            ctx.lineWidth = size * 0.07;
            const radius = size * 0.2;

            ctx.beginPath();
            ctx.roundRect(x, y, size, size, radius);
            ctx.stroke();
            ctx.font = `bold ${size * 0.5}px Arial`;
            ctx.textAlign = 'center';
            ctx.fillText('L', x + size/2, y + size * 0.68);
        }

        function drawVerticalLayout(ctx, cardImg, width, height) {
            // Card image - large and centered at top
            let cardBottomY = 100;
            if (cardImg) {
                const cardWidth = 520;
                const cardHeight = cardWidth * (cardImg.height / cardImg.width);
                const cardX = (width - cardWidth) / 2;
                const cardY = 100;

                // Card shadow
                ctx.shadowColor = 'rgba(0, 0, 0, 0.4)';
                ctx.shadowBlur = 40;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 20;

                ctx.drawImage(cardImg, cardX, cardY, cardWidth, cardHeight);
                ctx.shadowColor = 'transparent';
                cardBottomY = cardY + cardHeight;
            }

            // Card name - right after card
            const nameY = cardBottomY + 80;
            ctx.fillStyle = '#722F37';
            ctx.font = 'bold 64px "Cormorant Garamond", serif';
            ctx.textAlign = 'center';
            ctx.fillText(currentCardData.name, width / 2, nameY);

            // Decorative line under name
            ctx.strokeStyle = 'rgba(114, 47, 55, 0.4)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(width / 2 - 180, nameY + 25);
            ctx.lineTo(width / 2 + 180, nameY + 25);
            ctx.stroke();

            // Quote
            ctx.font = 'italic 36px "Cormorant Garamond", serif';
            ctx.fillStyle = 'rgba(114, 47, 55, 0.85)';
            const quote = `"${currentCardData.quote}"`;
            wrapText(ctx, quote, width / 2, nameY + 90, width - 160, 48);

            // Interpretation section
            const interpretY = nameY + 200;

            // Divider
            ctx.strokeStyle = 'rgba(114, 47, 55, 0.3)';
            ctx.beginPath();
            ctx.moveTo(120, interpretY);
            ctx.lineTo(width - 120, interpretY);
            ctx.stroke();

            // Interpretation label
            ctx.font = 'bold 28px "Prompt", sans-serif';
            ctx.fillStyle = '#722F37';
            ctx.fillText('คำทำนาย', width / 2, interpretY + 50);

            // Interpretation text - full text with bounds
            ctx.font = '26px "Prompt", sans-serif';
            ctx.fillStyle = '#722F37';
            const interpretation = currentCardData.interpretation.replace(/\n\n/g, ' ').replace(/\n/g, ' ');
            const maxInterpretY = height - 180; // Leave space for footer
            wrapText(ctx, interpretation, width / 2, interpretY + 110, width - 160, 38, maxInterpretY);

            // Footer - 2 columns layout with divider
            const iconSize = 26;
            const footerColor = 'rgba(114, 47, 55, 0.6)';
            const footerY = height - 120;

            // Calculate widths for centering
            const leftIconsWidth = iconSize * 1.4 * 3 + iconSize; // 4 icons
            const rightIconWidth = iconSize;
            const gap = 100; // Gap between two columns
            const totalWidth = leftIconsWidth + gap + rightIconWidth;
            const startX = (width - totalWidth) / 2;

            // Left column: 4 social icons + Pimfahmaprod
            drawSocialIcons(ctx, startX, footerY, iconSize, footerColor);
            ctx.textAlign = 'center';
            ctx.font = '20px "Prompt", sans-serif';
            ctx.fillStyle = footerColor;
            ctx.fillText('Pimfahmaprod', startX + leftIconsWidth / 2, footerY + iconSize + 28);

            // Right column: LINE icon + Line: @Pimfah
            const lineIconX = startX + leftIconsWidth + gap;
            drawLineIcon(ctx, lineIconX, footerY, iconSize, footerColor);
            ctx.textAlign = 'center';
            ctx.font = '20px "Prompt", sans-serif';
            ctx.fillStyle = footerColor;
            ctx.fillText('Line: @Pimfah', lineIconX + iconSize / 2, footerY + iconSize + 28);
        }

        function drawSquareLayout(ctx, cardImg, width, height) {
            // Card image - left side, large and vertically centered
            let cardRightX = 450;
            if (cardImg) {
                const cardHeight = height - 160;
                const cardWidth = cardHeight * (cardImg.width / cardImg.height);
                const cardX = 80;
                const cardY = 80;

                // Card shadow
                ctx.shadowColor = 'rgba(0, 0, 0, 0.4)';
                ctx.shadowBlur = 30;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 15;

                ctx.drawImage(cardImg, cardX, cardY, cardWidth, cardHeight);
                ctx.shadowColor = 'transparent';
                cardRightX = cardX + cardWidth + 50;
            }

            // Right side - Text area
            const textX = cardRightX;
            const textWidth = width - textX - 70;

            // Title small
            ctx.fillStyle = 'rgba(114, 47, 55, 0.6)';
            ctx.font = '24px "Cormorant Garamond", serif';
            ctx.textAlign = 'left';
            ctx.fillText('Valentine Tarot', textX, 130);

            // Card name - large (with dynamic sizing to fit)
            ctx.fillStyle = '#722F37';
            let nameFontSize = 52;
            ctx.font = `bold ${nameFontSize}px "Cormorant Garamond", serif`;
            let nameWidth = ctx.measureText(currentCardData.name).width;
            while (nameWidth > textWidth && nameFontSize > 28) {
                nameFontSize -= 2;
                ctx.font = `bold ${nameFontSize}px "Cormorant Garamond", serif`;
                nameWidth = ctx.measureText(currentCardData.name).width;
            }
            ctx.fillText(currentCardData.name, textX, 190);

            // Decorative line
            ctx.strokeStyle = 'rgba(114, 47, 55, 0.4)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(textX, 215);
            ctx.lineTo(textX + 200, 215);
            ctx.stroke();

            // Quote
            ctx.font = 'italic 24px "Cormorant Garamond", serif';
            ctx.fillStyle = 'rgba(114, 47, 55, 0.85)';
            const quote = `"${currentCardData.quote}"`;
            wrapTextLeft(ctx, quote, textX, 260, textWidth, 32);

            // Interpretation - full text with bounds
            ctx.font = '18px "Prompt", sans-serif';
            ctx.fillStyle = '#722F37';
            const interpretation = currentCardData.interpretation.replace(/\n\n/g, ' ').replace(/\n/g, ' ');
            const maxInterpretY = height - 140; // Leave space for footer
            wrapTextLeft(ctx, interpretation, textX, 360, textWidth, 26, maxInterpretY);

            // Footer - 2 columns layout with divider
            const iconSize = 18;
            const footerColor = 'rgba(114, 47, 55, 0.55)';
            const footerY = height - 95;
            const gap = 50;

            // Left column: 4 social icons + Pimfahmaprod
            drawSocialIcons(ctx, textX, footerY, iconSize, footerColor);
            const leftIconsWidth = iconSize * 1.4 * 3 + iconSize;
            ctx.textAlign = 'center';
            ctx.font = '14px "Prompt", sans-serif';
            ctx.fillStyle = footerColor;
            ctx.fillText('Pimfahmaprod', textX + leftIconsWidth / 2, footerY + iconSize + 20);

            // Right column: LINE icon + Line: @Pimfah
            const lineIconX = textX + leftIconsWidth + gap;
            drawLineIcon(ctx, lineIconX, footerY, iconSize, footerColor);
            ctx.textAlign = 'center';
            ctx.font = '14px "Prompt", sans-serif';
            ctx.fillStyle = footerColor;
            ctx.fillText('Line: @Pimfah', lineIconX + iconSize / 2, footerY + iconSize + 20);
        }

        function drawWideLayout(ctx, cardImg, width, height) {
            // Left side: Card image - fill height
            let cardRightX = 350;
            if (cardImg) {
                const cardHeight = height - 100;
                const cardWidth = cardHeight * (cardImg.width / cardImg.height);
                const cardX = 50;
                const cardY = 50;

                // Card shadow
                ctx.shadowColor = 'rgba(0, 0, 0, 0.4)';
                ctx.shadowBlur = 25;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 12;

                ctx.drawImage(cardImg, cardX, cardY, cardWidth, cardHeight);
                ctx.shadowColor = 'transparent';
                cardRightX = cardX + cardWidth + 50;
            }

            // Right side: Text - starts after card
            const textX = cardRightX;
            const textWidth = width - textX - 60;

            // Title small
            ctx.fillStyle = 'rgba(114, 47, 55, 0.6)';
            ctx.font = '20px "Cormorant Garamond", serif';
            ctx.textAlign = 'left';
            ctx.fillText('Valentine Tarot', textX, 80);

            // Card name - prominent (with dynamic sizing to fit)
            ctx.fillStyle = '#722F37';
            let nameFontSize = 42;
            ctx.font = `bold ${nameFontSize}px "Cormorant Garamond", serif`;
            let nameWidth = ctx.measureText(currentCardData.name).width;
            while (nameWidth > textWidth && nameFontSize > 24) {
                nameFontSize -= 2;
                ctx.font = `bold ${nameFontSize}px "Cormorant Garamond", serif`;
                nameWidth = ctx.measureText(currentCardData.name).width;
            }
            ctx.fillText(currentCardData.name, textX, 125);

            // Decorative line
            ctx.strokeStyle = 'rgba(114, 47, 55, 0.4)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(textX, 145);
            ctx.lineTo(textX + 200, 145);
            ctx.stroke();

            // Quote
            ctx.font = 'italic 20px "Cormorant Garamond", serif';
            ctx.fillStyle = 'rgba(114, 47, 55, 0.9)';
            const quote = `"${currentCardData.quote}"`;
            wrapTextLeft(ctx, quote, textX, 180, textWidth, 26);

            // Interpretation - full text with bounds
            ctx.font = '16px "Prompt", sans-serif';
            ctx.fillStyle = '#722F37';
            const interpretation = currentCardData.interpretation.replace(/\n\n/g, ' ').replace(/\n/g, ' ');
            const maxInterpretY = height - 90; // Leave space for footer
            wrapTextLeft(ctx, interpretation, textX, 260, textWidth, 22, maxInterpretY);

            // Footer - 2 columns layout with divider
            const iconSize = 14;
            const footerColor = 'rgba(114, 47, 55, 0.55)';
            const footerY = height - 62;
            const gap = 40;

            // Left column: 4 social icons + Pimfahmaprod
            drawSocialIcons(ctx, textX, footerY, iconSize, footerColor);
            const leftIconsWidth = iconSize * 1.4 * 3 + iconSize;
            ctx.textAlign = 'center';
            ctx.font = '12px "Prompt", sans-serif';
            ctx.fillStyle = footerColor;
            ctx.fillText('Pimfahmaprod', textX + leftIconsWidth / 2, footerY + iconSize + 16);

            // Right column: LINE icon + Line: @Pimfah
            const lineIconX = textX + leftIconsWidth + gap;
            drawLineIcon(ctx, lineIconX, footerY, iconSize, footerColor);
            ctx.textAlign = 'center';
            ctx.font = '12px "Prompt", sans-serif';
            ctx.fillStyle = footerColor;
            ctx.fillText('Line: @Pimfah', lineIconX + iconSize / 2, footerY + iconSize + 16);
        }

        function wrapText(ctx, text, x, y, maxWidth, lineHeight, maxY = Infinity) {
            const words = text.split(' ');
            let line = '';
            let testLine = '';

            for (let i = 0; i < words.length; i++) {
                testLine = line + words[i] + ' ';
                const metrics = ctx.measureText(testLine);
                if (metrics.width > maxWidth && i > 0) {
                    if (y > maxY) {
                        // Add ellipsis to last visible line
                        ctx.fillText(line.trim() + '...', x, y - lineHeight);
                        return y;
                    }
                    ctx.fillText(line.trim(), x, y);
                    line = words[i] + ' ';
                    y += lineHeight;
                } else {
                    line = testLine;
                }
            }
            if (y <= maxY + lineHeight) {
                ctx.fillText(line.trim(), x, y);
            }
            return y;
        }

        function wrapTextLeft(ctx, text, x, y, maxWidth, lineHeight, maxY = Infinity) {
            ctx.textAlign = 'left';
            const words = text.split(' ');
            let line = '';
            let testLine = '';

            for (let i = 0; i < words.length; i++) {
                testLine = line + words[i] + ' ';
                const metrics = ctx.measureText(testLine);
                if (metrics.width > maxWidth && i > 0) {
                    if (y > maxY) {
                        ctx.fillText(line.trim() + '...', x, y - lineHeight);
                        return y;
                    }
                    ctx.fillText(line.trim(), x, y);
                    line = words[i] + ' ';
                    y += lineHeight;
                } else {
                    line = testLine;
                }
            }
            if (y <= maxY + lineHeight) {
                ctx.fillText(line.trim(), x, y);
            }
            return y;
        }

        // Initialize - wait for all resources before showing the page
        waitForResources();
    </script>
</body>
</html>
